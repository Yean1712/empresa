<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin | Ninja Store</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        .admin-container { padding: 100px 5% 40px; max-width: 800px; margin: 0 auto; }
        .admin-card { background: #080808; padding: 30px; border-radius: 20px; border: 1px solid #1a1a1a; margin-bottom: 30px; }
        .form-group input, .form-group select { width: 100%; padding: 12px; margin-bottom: 15px; background: #121212; border: 1px solid #333; color: white; border-radius: 10px; }
        .btn-add { width: 100%; padding: 15px; background: #0071e3; color: white; border: none; border-radius: 10px; font-weight: bold; cursor: pointer; }
        .btn-cancel { background: #555; margin-top: 10px; display: none; }
        .prod-list { margin-top: 20px; border-top: 1px solid #222; }
        .prod-item { display: flex; justify-content: space-between; padding: 15px 0; border-bottom: 1px solid #111; align-items: center; }
        .actions { display: flex; gap: 10px; }
        .btn-del { background: #ff3b30; color: white; border: none; padding: 8px 12px; border-radius: 8px; cursor: pointer; }
        .btn-edit { background: #34c759; color: white; border: none; padding: 8px 12px; border-radius: 8px; cursor: pointer; }
    </style>
</head>
<body style="display: none;"> 
    <div class="admin-container">
        <div class="admin-card">
            <h2 id="form-title">Subir Nuevo Producto</h2>
            <div class="form-group"><input type="text" id="pNombre" placeholder="Nombre del Producto"></div>
            <div class="form-group"><input type="number" id="pPrecio" placeholder="Precio en $"></div>
            <div class="form-group">
                <select id="pCategoria">
                    <option value="apple">iPhone</option>
                    <option value="android">Android</option>
                    <option value="offer">Oferta ðŸ”¥</option>
                    <option value="acc">Accesorios</option>
                </select>
            </div>
            <div class="form-group"><input type="text" id="pImagen" placeholder="URL de la imagen"></div>
            <button class="btn-add" id="btn-save" onclick="guardar()">Publicar Producto</button>
            <button class="btn-add btn-cancel" id="btn-cancel" onclick="cancelarEdicion()">Cancelar EdiciÃ³n</button>
        </div>

        <div class="admin-card">
            <h3>Inventario Actual</h3>
            <div id="lista-admin" class="prod-list"></div>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <script src="auth.js"></script>
    <script>
        let editId = null;

        function guardar() {
            const n = document.getElementById('pNombre').value;
            const p = document.getElementById('pPrecio').value;
            const c = document.getElementById('pCategoria').value;
            const i = document.getElementById('pImagen').value;

            if(!n || !p || !i) return alert("Completa los datos");

            const data = { nombre: n, precio: p, categoria: c, imagen: i, fecha: firebase.firestore.FieldValue.serverTimestamp() };

            if(editId) {
                db.collection("productos").doc(editId).update(data)
                    .then(() => { alert("Producto actualizado"); cancelarEdicion(); })
                    .catch(err => alert("Error: " + err.message));
            } else {
                db.collection("productos").add(data)
                    .then(() => { alert("Producto subido"); location.reload(); })
                    .catch(err => alert("Error: " + err.message));
            }
        }

        function prepararEdicion(id, nombre, precio, cat, img) {
            editId = id;
            document.getElementById('pNombre').value = nombre;
            document.getElementById('pPrecio').value = precio;
            document.getElementById('pCategoria').value = cat;
            document.getElementById('pImagen').value = img;
            document.getElementById('form-title').innerText = "Editando Producto";
            document.getElementById('btn-save').innerText = "Guardar Cambios";
            document.getElementById('btn-cancel').style.display = "block";
        }

        function cancelarEdicion() {
            editId = null;
            location.reload();
        }

        db.collection("productos").orderBy("fecha", "desc").onSnapshot(snap => {
            const div = document.getElementById('lista-admin');
            div.innerHTML = "";
            snap.forEach(doc => {
                const prod = doc.data();
                div.innerHTML += `
                    <div class="prod-item">
                        <span>${prod.nombre} - $${prod.precio}</span>
                        <div class="actions">
                            <button class="btn-edit" onclick="prepararEdicion('${doc.id}', '${prod.nombre}', '${prod.precio}', '${prod.categoria}', '${prod.imagen}')">Editar</button>
                            <button class="btn-del" onclick="borrar('${doc.id}')">Eliminar</button>
                        </div>
                    </div>`;
            });
        });

        function borrar(id) {
            if(confirm("Â¿Seguro que quieres borrarlo?")) {
                db.collection("productos").doc(id).delete();
            }
        }
    </script>
</body>
</html>
