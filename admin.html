<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Panel Admin | Ninja Store</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body style="background: #000; color: white; padding: 20px; font-family: 'Inter', sans-serif;">
    
    <header style="margin-bottom: 30px;">
        <nav style="display: flex; justify-content: space-between; align-items: center; max-width: 1000px; margin: 0 auto;">
            <div class="logo" style="font-weight: 800; color: #0071e3;">üõ†Ô∏è NINJA ADMIN</div>
            <div class="nav-links">
                <a href="index.html" style="color: white; text-decoration: none; margin-right: 15px;">Ver Web</a>
                <a href="catalogo.html" style="color: white; text-decoration: none;">Ver Cat√°logo</a>
            </div>
        </nav>
    </header>

    <div style="max-width: 900px; margin: 0 auto;">
        
        <section style="background: #080808; padding: 25px; border-radius: 20px; border: 1px solid #1a1a1a; margin-bottom: 40px;">
            <h2 style="margin-bottom: 20px; color: #0071e3;">‚ûï Agregar Nuevo Producto</h2>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                <input type="text" id="p-nombre" placeholder="Nombre (ej: iPhone 15 Pro)" style="padding: 12px; border-radius: 8px; border: 1px solid #333; background: #121212; color: white;">
                <input type="number" id="p-precio" placeholder="Precio en $" style="padding: 12px; border-radius: 8px; border: 1px solid #333; background: #121212; color: white;">
                <select id="p-categoria" style="padding: 12px; border-radius: 8px; border: 1px solid #333; background: #121212; color: white;">
                    <option value="apple">iPhone</option>
                    <option value="android">Android</option>
                    <option value="acc">Accesorios</option>
                    <option value="offer">Oferta üî•</option>
                </select>
                <input type="text" id="p-img" placeholder="Nombre de la foto (ej: iphone15.jpg)" style="padding: 12px; border-radius: 8px; border: 1px solid #333; background: #121212; color: white;">
                <button onclick="guardarProducto()" style="grid-column: span 2; background: #0071e3; color: white; padding: 15px; border: none; border-radius: 12px; font-weight: bold; cursor: pointer;">Guardar en Cat√°logo</button>
            </div>
        </section>

        <h2 style="margin-bottom: 20px;">üì¶ Gesti√≥n de Inventario</h2>
        <div id="lista-productos-admin" style="display: grid; gap: 10px; margin-bottom: 50px;">
            <p style="color: #555;">Cargando productos...</p>
        </div>

        <h2 style="margin-bottom: 20px; color: #ff3b30;">üí∞ Ventas Recientes (WhatsApp)</h2>
        <div id="lista-todas-compras">
            <p style="color: #555;">No hay ventas registradas a√∫n.</p>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <script src="auth.js"></script>

    <script>
        // --- FUNCI√ìN: GUARDAR ---
        function guardarProducto() {
            const nombre = document.getElementById('p-nombre').value;
            const precio = document.getElementById('p-precio').value;
            const categoria = document.getElementById('p-categoria').value;
            const imagen = document.getElementById('p-img').value;

            if(!nombre || !precio || !imagen) return alert("‚ö†Ô∏è Llena todos los campos");

            db.collection("productos").add({
                nombre: nombre,
                precio: precio,
                categoria: categoria,
                imagen: imagen,
                fecha: new Date()
            }).then(() => {
                alert("‚úÖ Producto agregado!");
                location.reload();
            });
        }

        // --- FUNCI√ìN: CARGAR PRODUCTOS PARA GESTI√ìN ---
        db.collection("productos").onSnapshot((snapshot) => {
            const lista = document.getElementById('lista-productos-admin');
            lista.innerHTML = "";
            snapshot.forEach((doc) => {
                const p = doc.data();
                lista.innerHTML += `
                    <div style="background: #080808; padding: 15px; border-radius: 15px; display: flex; justify-content: space-between; align-items: center; border: 1px solid #1a1a1a;">
                        <div style="display: flex; align-items: center; gap: 15px;">
                            <img src="${p.imagen}" style="width: 40px; height: 40px; border-radius: 5px; object-fit: cover;" onerror="this.src='logo.jpg'">
                            <div>
                                <strong style="display: block;">${p.nombre}</strong>
                                <span style="color: #0071e3;">$${p.precio}</span>
                            </div>
                        </div>
                        <div style="display: flex; gap: 8px;">
                            <button onclick="editarTodo('${doc.id}', '${p.nombre}', '${p.precio}', '${p.imagen}')" style="background: #333; color: white; border: none; padding: 8px 12px; border-radius: 8px; cursor: pointer; font-size: 0.8rem;">Editar</button>
                            <button onclick="eliminarProducto('${doc.id}')" style="background: #ff3b3022; color: #ff3b30; border: 1px solid #ff3b30; padding: 8px 12px; border-radius: 8px; cursor: pointer; font-size: 0.8rem;">Borrar</button>
                        </div>
                    </div>`;
            });
        });

        // --- FUNCI√ìN: EDITAR (TODO) ---
        function editarTodo(id, nombreAct, precioAct, imgAct) {
            const nuevoNombre = prompt("Nuevo nombre:", nombreAct);
            const nuevoPrecio = prompt("Nuevo precio:", precioAct);
            const nuevaImg = prompt("Nombre de la nueva imagen (deja igual si no cambia):", imgAct);

            if (nuevoNombre && nuevoPrecio && nuevaImg) {
                db.collection("productos").doc(id).update({
                    nombre: nuevoNombre,
                    precio: nuevoPrecio,
                    imagen: nuevaImg
                }).then(() => alert("‚úÖ Actualizado!"));
            }
        }

        // --- FUNCI√ìN: ELIMINAR ---
        function eliminarProducto(id) {
            if(confirm("¬øSeguro que quieres borrar este producto?")) {
                db.collection("productos").doc(id).delete();
            }
        }

        // --- FUNCI√ìN: CARGAR VENTAS ---
        db.collection("compras").orderBy("fecha", "desc").onSnapshot((snapshot) => {
            const contenedor = document.getElementById('lista-todas-compras');
            contenedor.innerHTML = "";
            snapshot.forEach((doc) => {
                const data = doc.data();
                contenedor.innerHTML += `
                    <div style="border: 1px solid #222; background: #080808; padding: 15px; border-radius: 15px; margin-bottom: 10px;">
                        <p><strong>Cliente:</strong> ${data.userName || 'Usuario'}</p>
                        <p><strong>Pedido:</strong> ${data.producto} <span style="color:#0071e3;">($${data.precio})</span></p>
                        <small style="color: #444;">${data.fecha}</small>
                    </div>`;
            });
        });
    </script>
</body>
</html>